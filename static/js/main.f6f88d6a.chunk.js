(this["webpackJsonpnews-app"]=this["webpackJsonpnews-app"]||[]).push([[0],{133:function(e,t,n){},146:function(e,t,n){"use strict";n.r(t);var r,c=n(4),a=n(0),s=n.n(a),i=n(32),o=n.n(i),u=n(17),j=n(160),l=n(162),d=n(156),b=function(){return Object(c.jsx)(d.a,{active:!0,inverted:!0,size:"large"})},f=n(10),m=n(40),O=n(47),p=n(13),h=n.n(p),x=n(28),v=n(21),w="https://hacker-news.firebaseio.com/v0",g=function(){var e=Object(x.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(w,"/item/").concat(t,".json"));case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(x.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(w,'/newstories.json?orderBy="$key"&limitToFirst=').concat(100));case 2:if(!(t=e.sent).ok){e.next=8;break}return e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",Promise.all(n.map(function(){var e=Object(x.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(x.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(){var e=Object(x.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=Object(v.c)({sortComparer:function(e,t){return t.time-e.time}}),C=I.getInitialState({loading:"idle"}),N=Object(v.b)("news/fetchNewsList",Object(x.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return e&&!e.error&&!e.deleted})));case 4:case"end":return e.stop()}}),e)})))),S=Object(v.b)("news/fetchNewsItem",function(){var e=Object(x.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t);case 2:if(!(n=e.sent)){e.next=5;break}return e.abrupt("return",n);case 5:throw new Error;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),L=Object(v.d)({name:"news",initialState:C,reducers:{},extraReducers:(r={},Object(O.a)(r,N.pending,(function(e){e.loading="loading"})),Object(O.a)(r,N.fulfilled,(function(e,t){e.loading="succeeded",I.upsertMany(e,t.payload)})),Object(O.a)(r,N.rejected,(function(e){e.loading="failed"})),Object(O.a)(r,S.fulfilled,I.upsertOne),r)}),E=I.getSelectors((function(e){return e.newsList})),A=E.selectAll,T=E.selectById,z=L.reducer,B=function(e){var t=e.timestamp,n=new Date(1e3*t),r=n.toLocaleDateString("ru"),a=n.toLocaleTimeString("ru");return Object(c.jsxs)("div",{children:[Object(c.jsx)("span",{children:r}),Object(c.jsx)("small",{style:{marginLeft:"5px"},children:a})]})},D=function(e){var t=e.id,n=Object(f.f)(),r=Object(u.c)((function(e){return T(e,t)})),a=r.title,s=r.time,i=r.by,o=r.score;return Object(c.jsx)(j.a.Item,{onClick:function(){n.push("/news/".concat(t))},children:Object(c.jsxs)(j.a.Content,{children:[Object(c.jsx)(j.a.Header,{children:a}),Object(c.jsx)(j.a.Description,{children:Object(c.jsx)(B,{timestamp:s})}),Object(c.jsxs)("div",{className:"author",children:["by ",i]}),Object(c.jsxs)("div",{className:"rating",children:[Object(c.jsx)(m.a,{color:"yellow",name:"star"}),Object(c.jsx)("span",{className:"rating-count",children:o})]})]})})},M=function(){var e,t=Object(u.b)(),n=Object(u.c)((function(e){return e.newsList.loading})),r=Object(u.c)(A),s=r.map((function(e){return Object(c.jsx)(D,{id:e.id},e.id)}));Object(a.useEffect)((function(){"idle"===n&&t(N())}),[n,t]),Object(a.useEffect)((function(){var e=setInterval((function(){t(N())}),6e4);return function(){clearInterval(e)}}),[t]);var i=Object(c.jsx)("div",{children:Object(c.jsx)(j.a,{divided:!0,inverted:!0,ordered:!0,relaxed:"very",content:s})});return"loading"===n?e=r.length?i:Object(c.jsx)(b,{}):"succeeded"===n?e=i:"failed"===n&&(e=Object(c.jsx)("div",{style:{textAlign:"center"},children:"Failed to load news!"})),Object(c.jsxs)("div",{children:[Object(c.jsx)(l.a,{className:"refresh-news-btn",icon:"refresh",content:"Refresh",size:"large",onClick:function(){t(N())}}),e]})},R=n(157),F=(n(133),n(65)),G=n(161),H=n(83),J=n(158),P=n(112),$=n.n(P),q=n(159),K=Object(v.c)({sortComparer:function(e,t){return t.time-e.time}}),Q=K.getInitialState(),U=Object(v.b)("comments/fetchComments",function(){var e=Object(x.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t);case 2:return n=e.sent,e.abrupt("return",n.filter((function(e){return e&&!e.error&&!e.deleted})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),V=Object(v.d)({name:"comments",initialState:Q,reducers:{},extraReducers:Object(O.a)({},U.fulfilled,(function(e,t){K.upsertMany(e,t.payload)}))}),W=K.getSelectors((function(e){return e.comments})),X=W.selectAll,Y=(W.selectById,V.reducer),Z=function e(t){var n,r=t.comment,s=Object(u.b)(),i=Object(a.useState)(!1),o=Object(H.a)(i,2),j=o[0],l=o[1],d=r.id,f=r.by,m=r.time,O=r.text,p=r.kids,h=void 0===p?[]:p,x=Object(u.c)(X).filter((function(e){return+e.parent===+d}));O&&(n=$()(O));var v=[];h.length&&v.push("is-parent-comment");return Object(c.jsx)(q.a.Group,{threaded:!0,size:"large",children:Object(c.jsxs)(q.a,{children:[Object(c.jsxs)(q.a.Content,{className:v.join(" "),onClick:function(){h.length&&(l(!0),s(U(h)).then((function(){l(!1)})))},children:[Object(c.jsx)(q.a.Author,{as:"span",children:f}),Object(c.jsx)(q.a.Metadata,{children:Object(c.jsx)(B,{timestamp:m})}),Object(c.jsx)(q.a.Text,{children:n})]}),j&&Object(c.jsx)(b,{}),Object(c.jsx)(J.a.Group,{animation:"slide down",duration:300,children:x.map((function(t){return Object(c.jsx)("div",{children:Object(c.jsx)(e,{comment:t})},t.id)}))})]})})},_=s.a.memo(Z),ee=function(e){var t=e.commentsIds,n=e.parentId,r=Object(u.b)(),s=Object(f.g)().pathname,i=Object(a.useState)("loading"),o=Object(H.a)(i,2),j=o[0],l=o[1],d=Object(u.c)(X);d=d.filter((function(e){return+e.parent===+n})),Object(a.useEffect)((function(){window.scrollTo(0,0)}),[s]),Object(a.useEffect)((function(){var e,n=!1;return"loading"===j&&(e=r(U(t))).then(v.e).then((function(){n=!0,l("loaded")})).catch((function(e){e.message&&"Aborted"!==e.message&&l("failed")})),function(){"loading"!==j||n||e.abort()}}),[j,r,t]);var m=Object(c.jsx)("div",{style:d.length?{marginTop:"20px"}:null,children:d.map((function(e){return Object(c.jsx)(_,{comment:e},e.id)}))});return Object(c.jsxs)("div",{children:["loading"===j&&Object(c.jsx)(b,{}),"failed"===j&&Object(c.jsx)("div",{style:{marginTop:"10px"},children:"Failed loading comments."}),Object(c.jsx)(J.a.Group,{duration:500,children:"loaded"===j&&m})]})},te=s.a.memo(ee),ne=function(e){var t=e.match,n=Object(f.f)(),r=Object(u.b)(),s=t.params.id,i=Object(u.c)((function(e){return T(e,s)}));if(Object(a.useEffect)((function(){var e=setInterval((function(){r(S(s))}),6e4);return function(){clearInterval(e)}}),[r,s]),!i)return Object(c.jsx)("h2",{style:{textAlign:"center"},children:"News not found."});var o=i.title,j=i.url,d=i.by,b=i.time,O=i.descendants,p=i.kids,h=void 0===p?[]:p;return Object(c.jsxs)("div",{children:[Object(c.jsx)(l.a,{className:"refresh-comments-btn",icon:"refresh",content:"Refresh Comments",size:"large",onClick:function(){r(S(s))}}),Object(c.jsx)(l.a,{className:"home-btn",icon:"home",content:"News List",size:"large",onClick:function(){return n.push("/")}}),Object(c.jsxs)(G.a,{centered:!0,fluid:!0,children:[Object(c.jsxs)(G.a.Content,{children:[Object(c.jsx)(G.a.Header,{children:o}),Object(c.jsx)(G.a.Meta,{children:Object(c.jsx)(B,{timestamp:b})}),Object(c.jsxs)(G.a.Description,{children:[Object(c.jsx)("div",{className:"card-url-wrap",children:Object(c.jsx)("a",{href:j,target:"blank",className:"card-url",children:j})}),Object(c.jsxs)("div",{children:["By ",d]})]})]}),Object(c.jsxs)(G.a.Content,{extra:!0,children:[Object(c.jsx)(m.a,{name:"comments"}),O," comments",Object(c.jsx)(te,{commentsIds:h,parentId:s})]})]})]})},re=s.a.memo(ne),ce=function(){return Object(c.jsx)(F.a,{basename:"/news-app",children:Object(c.jsx)(R.a,{children:Object(c.jsxs)(f.c,{children:[Object(c.jsx)(f.a,{exact:!0,path:"/",component:M}),Object(c.jsx)(f.a,{exact:!0,path:"/news/:id",component:re})]})})})},ae=Object(v.a)({reducer:{newsList:z,comments:Y}});o.a.render(Object(c.jsx)(u.a,{store:ae,children:Object(c.jsx)(ce,{})}),document.getElementById("root"))}},[[146,1,2]]]);
//# sourceMappingURL=main.f6f88d6a.chunk.js.map